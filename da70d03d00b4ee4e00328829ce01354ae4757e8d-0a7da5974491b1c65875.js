"use strict";(self.webpackChunkkaagzi=self.webpackChunkkaagzi||[]).push([[460],{5832:function(e,t,n){n.d(t,{A:function(){return m}});var r=n(6540),l=n(4794),a=n(5227),o=n(4398),i="brokerLogin-module--brokerLoginCta--39fcf",s="brokerLogin-module--brokerSwitchBtn--d6123",c="brokerLogin-module--noUserWrap--c07af",u="brokerLogin-module--orSep--5a79b";function m(e){let{broker:t,doOnLoginClick:n,goToUrlOnLoginClick:m,referralUrlForNewSignupWithBroker:d}=e;return["Zerodha","Angel One","Upstox","5paisa","Alice Blue"].includes(t)?r.createElement(r.Fragment,null,r.createElement(o.A,null),r.createElement("div",{id:c},r.createElement("div",null,n&&"function"==typeof n?r.createElement("button",{className:i,onClick:n},"Zerodha"===t&&r.createElement("img",{src:"/img/logo-kite.png",alt:"Zerodha Kite"}),"Angel One"===t&&r.createElement("img",{src:"/img/logo-angelOne.webp",alt:"Angel One"}),"Upstox"===t&&r.createElement("img",{src:"/img/logo-upstox.webp",alt:"Upstox"}),"5paisa"===t&&r.createElement("img",{src:"/img/logo-5paisa.webp",alt:"5paisa"}),r.createElement("span",null,"Sign into ",t)):r.createElement("a",{className:i,href:m,target:"_blank",rel:"noopener noreferrer"},"Zerodha"===t&&r.createElement("img",{src:"/img/logo-kite.png",alt:"Zerodha Kite"}),"Angel One"===t&&r.createElement("img",{src:"/img/logo-angelOne.webp",alt:"Angel One"}),"Upstox"===t&&r.createElement("img",{src:"/img/logo-upstox.webp",alt:"Upstox"}),"5paisa"===t&&r.createElement("img",{src:"/img/logo-5paisa.webp",alt:"5paisa"}),r.createElement("span",null,"Sign into ",t)),d&&"string"==typeof d&&""!==d.trim()&&r.createElement("p",null,"Don't have an account with ",t,"?"," ",r.createElement(a.r,{href:d,target:"_blank",rel:"noopener noreferrer"},"Open Account")),r.createElement("div",{className:u},"OR"),r.createElement(l.Link,{className:s,to:"/app"},"Choose different broker")))):null}},6428:function(e,t,n){n.d(t,{A:function(){return i}});var r=n(6540),l=n(3654),a=n(7104),o="instrumentsNotFoundList-module--instrumentsNotFoundListC--c3d6b";function i(e){let{instrumentsNotFoundAry:t,title:n,description:i,currentBroker:s,onItemDeleteBtnClick:c}=e;return t.length<1?null:r.createElement("div",{className:o},r.createElement("h3",null,n||"Instruments not found"),i&&""!==i.trim()?r.createElement("p",null,i):r.createElement("p",null,"Foll instruments not found",""+(s?" in "+s:"")),t.map(((e,t)=>{let{symbol:n,exchange:o,broker:i}=e;return r.createElement("div",{key:`${t}${n}${o}`},"Upstox"===i&&r.createElement("img",{src:"/img/logo-upstox.webp",alt:"Upstox"}),"Angel One"===i&&r.createElement("img",{src:"/img/logo-angelOne.webp",alt:"Angel One"}),"Zerodha"===i&&r.createElement("img",{src:"/img/logo-kite.png",alt:"Zerodha"}),r.createElement(a.A,{tradingsymbol:n,exchange:o}),c&&"function"==typeof c&&r.createElement(l.Ay,{variant:"tertiary",isDark:!0,icon:"trash-2",onClick:c.bind(this,n,o)}))})))}},9354:function(e,t,n){n.d(t,{A:function(){return A}});var r=n(6540),l=n(2059),a=n(3654),o=n(7616),i="toggleSwitch-module--tglChip--f8fca",s="toggleSwitch-module--y--ee581";function c(e){let{isOn:t,children:n,onToggle:l,isDisabled:a,className:o}=e;return r.createElement("button",{className:`${i}${o?" "+o:""}${t?" "+s:""}`,disabled:a,onClick:()=>{l&&!a&&(null==l||l())}},n)}var u="dropdownSelect-module--actv--e6cf6",m="dropdownSelect-module--drpdnSlctC--d6a22",d="dropdownSelect-module--drpdnSlctCCompact--74b54",h="dropdownSelect-module--drpdnSlctD--71d50",g="dropdownSelect-module--drpdnSlctDDockCenter--f0dd2",p="dropdownSelect-module--drpdnSlctDDockRight--3cc8f",f="dropdownSelect-module--grid3--8bd76",E="dropdownSelect-module--rdoClrBtn--41239";function y(e){let{label:t,choices:n,doOnChange:l,initialChoice:a,docking:o,showOptionsInGrid:i,showCaretBelowLabel:s}=e;const c=a?n.indexOf(a):-1,{0:y,1:v}=(0,r.useState)(c<0?null:c),{0:b,1:w}=(0,r.useState)(!1),x=(0,r.useRef)(null),A=e=>{x.current&&!x.current.contains(e.target)&&w(!1)};return(0,r.useEffect)((()=>(document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)})),[]),r.createElement("div",{ref:x,className:`${m}${s?" "+d:""}${null!==y?" "+u:""}`},r.createElement("button",{onClick:()=>{w(!b)}},null!==y?n[y]:t),b&&r.createElement("div",{className:`${h}${"center"===o?" "+g:"right"===o?" "+p:""}${i?" "+f:""}`},null!==y&&r.createElement("button",{onClick:()=>{v(null),l&&"function"==typeof l&&l(null,null),w(!1)},className:E},"Clear"),n.map(((e,n)=>n===y?r.createElement("span",{key:`${t}_${n}_s`},e):r.createElement("button",{key:`${t}_${n}`,onClick:()=>{v(n),l&&"function"==typeof l&&l(e,n),w(!1)}},e)))))}var v="fnoFilter-module--fnoFilterC--d8a2a";function b(e){let{typeFilter:t,setTypeFilter:n,yearFilter:o,setYearFilter:i,monthFilter:s,setMonthFilter:c,strikeFilter:u,setStrikeFilter:m}=e;const d=(new Date).getFullYear(),h=[(d-1).toString(),d.toString(),(d+1).toString(),(d+2).toString()],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return r.createElement("div",{className:v},r.createElement(y,{label:"Type",choices:["CE","PE","FUT"],showCaretBelowLabel:!0,initialChoice:t,doOnChange:e=>{n&&n("CE"===e||"PE"===e||"FUT"===e?e:void 0)}}),r.createElement(y,{label:"Year",choices:h,showCaretBelowLabel:!0,initialChoice:o?o.toString():void 0,doOnChange:e=>{i&&(e&&""!==e&&!isNaN(Number(null==e?void 0:e.trim()))?i(Number(e)):i(void 0))}}),r.createElement(y,{label:"Month",choices:g,showCaretBelowLabel:!0,docking:"center",showOptionsInGrid:!0,initialChoice:s?g[s-1]:void 0,doOnChange:(e,t)=>{c&&c(null!==e&&null!==t?t+1:void 0)}}),r.createElement(l.Ay,{title:"Strike Price",type:"number",placeholder:"Strike Price",value:u||"",onChange:e=>{m&&m(e.target.value)},actionPane:u&&""!==u.trim()&&r.createElement(a.Ay,{variant:"tertiary",size:"small",icon:"x",isDark:!0,onClick:()=>{m&&m(void 0)},isDisabled:"FUT"===t}),isDisabled:"FUT"===t}))}var w="searchInputWithExchangeFilter-module--searchFilterTabsC--5eaaa",x="searchInputWithExchangeFilter-module--srchNote--bedbd";function A(e){let{placeholderText:t,searchQuery:n,setSearchQuery:i,exchangesAry:s,doOnExitSearchMode:u,doSearch:m,doBeforeSearchStarts:d,doAfterSearchFinishes:h,note:g,isDisabled:p}=e;const{0:f,1:E}=(0,r.useState)(null),{0:y,1:v}=(0,r.useState)(!1),{0:A,1:S}=(0,r.useState)(void 0),{0:k,1:N}=(0,r.useState)(void 0),{0:C,1:F}=(0,r.useState)(void 0),{0:P,1:O}=(0,r.useState)(void 0),I=(0,r.useRef)(null),T=()=>{if("NFO"===f||"CDS"===f||"MCX"===f){const e="FUT"!==A?Number(null==P?void 0:P.trim()):void 0;null==m||m(f,y?n+"|":n,A,k,C,e&&isNaN(e)||0==e?void 0:e)}else f&&(null==m||m(f,n,void 0,void 0,void 0,void 0))};(0,r.useEffect)((()=>{""!==n.trim()?(null==d||d(),clearTimeout(I.current),I.current=setTimeout((()=>{T(),null==h||h()}),1e3)):null==u||u()}),[n,P]);const D=(0,r.useRef)(!1);return(0,r.useEffect)((()=>{D.current?""!==n.trim()&&f&&(null==d||d(),T(),null==h||h()):(s&&s.length>0&&E(s[0]),D.current=!0)}),[f,A,k,C,y]),r.createElement(r.Fragment,null,r.createElement(l.Ay,{type:"text",name:"search",icon:"search",placeholder:t&&""!==t.trim()?t:"Search",value:n,onChange:e=>{i(e.target.value)},actionPane:""!==n.trim()?r.createElement(r.Fragment,null,("NFO"===f||"CDS"===f||"MCX"===f)&&r.createElement(c,{isOn:y,onToggle:()=>{v(!y)}},"Exact Search"),r.createElement(a.Ay,{variant:"tertiary",size:"small",icon:"x",isDark:!0,onClick:()=>{i("")}})):g&&r.createElement("span",{className:x},g),isDisabled:p}),s&&s.length>0&&""!==n.trim()&&r.createElement(r.Fragment,null,E&&"function"==typeof E&&r.createElement(o.A,{className:w,tabsAry:s,selectedTab:f,setSelectedTab:E}),("NFO"===f||"CDS"===f||"MCX"===f)&&r.createElement(b,{typeFilter:A,setTypeFilter:S,yearFilter:k,setYearFilter:N,monthFilter:C,setMonthFilter:F,strikeFilter:P,setStrikeFilter:O})))}},6278:function(e,t,n){n.d(t,{O:function(){return p},A:function(){return g}});var r=n(6540),l=n(214),a=n(3654),o=n(2059),i=n(8208),s=n(1298),c=n(1381),u="newTradePositionDialog-module--capitalReq--8c94f",m="newTradePositionDialog-module--instrmntInfo--56e73",d="newTradePositionDialog-module--newTradePositionDlgC--f5d8b",h="newTradePositionDialog-module--newTrdPosC--144ac";function g(e){var t,n;let{instrument:l,ltp:a,closePrice:o,enterPosition:s,doOnOpeningOrUpdatingPos:c,doOnCancel:u,closeDialog:h}=e;return r.createElement("div",{className:d},r.createElement(i.A,{className:m,tradingsymbol:l.symbol,exchange:l.exchange,entityName:(null==l||null===(t=l.name)||void 0===t||null===(n=t.trim)||void 0===n?void 0:n.call(t))||"",ltp:a,closePrice:o,onRemoveClick:()=>{},closeExpandedView:()=>{}}),r.createElement(p,{instrument:l,ltp:a,enterPosition:s,doOnOpeningOrUpdatingPos:c,doOnCancel:u,closeDialog:h}))}function p(e){let{instrument:t,ltp:n,enterPosition:i,doOnOpeningOrUpdatingPos:m,doOnCancel:d,closeDialog:g}=e;const{0:p,1:f}=(0,r.useState)(t.lotSize),{0:E,1:y}=(0,r.useState)(""),{0:v,1:b}=(0,r.useState)(!1),{notify:w}=(0,r.useContext)(s._),x=(0,r.useContext)(c.M),A=e=>isNaN(Number(e))?"Quantity should be a number":Number.isInteger(Number(e))?null!=t&&t.lotSize&&e<t.lotSize?"Quantity cannot be less than lot-size":null!=t&&t.lotSize&&e%t.lotSize!=0?"Quantity should be a multiple of lot-size":"":"Quantity should be an integer",S=e=>{y(A(e)),f(e)};return r.createElement("div",{className:h},r.createElement("div",null,r.createElement(o.df,{title:"Quantity",placeholder:"Quantity",value:p,minValue:t.lotSize,stepSize:t.lotSize,onChange:e=>{S(Number(e.target.value))},onDecrement:S,onIncrement:S,error:E,info:t.lotSize>1&&p%t.lotSize==0?`${p/t.lotSize} lot${p===t.lotSize?"":"s"}`:""})),r.createElement("div",{className:u},null==n?"-.--":(0,l.kH)(n*p)),r.createElement("div",null,r.createElement(a.Ay,{variant:"tertiary",isDark:!0,onClick:()=>{null==d||d(),null==g||g()}},"Cancel"),r.createElement(a.Ay,{variant:"buy",onClick:async()=>{if(!x)return w("Network unavailable","err"),!1;const e=A(p);if(v)return!1;if(""!==e)return w(e,"err"),!1;if(!n)return w("Error inferring entry price","err"),!1;try{if(b(!0),!await i(t.symbol,t.exchange,n,p,"B"))throw new Error;return m&&"function"==typeof m&&m(t),null==g||g(),!0}catch(r){return!1}finally{b(!1)}},isWip:v,wipText:"Buying"},"BUY")))}},9322:function(e,t,n){n.d(t,{A:function(){return m}});var r=n(6540),l=n(9611),a=n(7104),o="positionListItem-module--avg--e4ab8",i="positionListItem-module--ltp--c9cf8",s="positionListItem-module--posC--b645b",c="positionListItem-module--posC_compactVuOnly--c5fd8",u="positionListItem-module--qty--9d730";function m(e){let{wrapperElement:t="div",tradingsymbol:n,exchange:m,qty:d,avg:h,ltp:g,direction:p,expiry:f,compactViewOnly:E,className:y,...v}=e,b=null,w=null;return g&&(b=("S"===p?h-g:g-h)*d,w=(b/(h*d)*100).toFixed(2)),r.createElement(t,Object.assign({className:`${s}${E?" "+c:""}${y&&"string"==typeof y&&""!==y.trim()?" "+y:""}`},v),r.createElement(a.A,{tradingsymbol:n,exchange:m,isPositionSymbol:!0,isSellTrade:"S"===p}),r.createElement("span",{className:u},d),r.createElement("span",{className:o},h.toFixed(2)),r.createElement("span",{className:i},g&&!isNaN(g)&&g.toFixed(2)),r.createElement(l.A,{currentVal:b,baseVal:0}),r.createElement(l.A,{currentVal:w,baseVal:0}))}},6422:function(e,t,n){n.d(t,{A:function(){return y}});var r=n(6540),l=n(214),a=n(3654),o=n(2059),i=n(9322),s=n(6278),c="positionEntryExitRecords-module--posEntryExitRecordsC--be255";function u(e){var t;let{pos:n}=e;return r.createElement("div",{className:c},r.createElement("header",null,r.createElement("span",null,"Time"),r.createElement("span",null,"Qty")),n.h&&Array.isArray(n.h)&&(null==n||null===(t=n.h)||void 0===t?void 0:t.length)>0&&n.h.map(((e,t)=>{const n=(0,l.bR)(new Date(e[0]),!1,!0,!0,!0).split(", ");return r.createElement("div",{key:`${e[0]}-${t}`,"data-date":n[0],"data-qty":e[1]},r.createElement("span",null,n[1]),r.createElement("span",null,e[2]))})))}var m=n(1298),d="tradePositionMgmtDialog-module--active--c2a0e",h="tradePositionMgmtDialog-module--amtFreeAfterExit--2f6b5",g="tradePositionMgmtDialog-module--exitTrdPosC--7fd76",p="tradePositionMgmtDialog-module--posCtaTabs--bc300",f="tradePositionMgmtDialog-module--posInfo--4e6ad",E="tradePositionMgmtDialog-module--tradePositionMgmtC--1d2bc";function y(e){let{positionToExit:t,ltp:n,exitPosition:l,doOnSuccessfulExit:a,addLotsToPosition:o,doOnAddingLotsToPos:c,closeDialog:m}=e;const{0:h,1:g}=(0,r.useState)(0);return r.createElement("div",{className:E},r.createElement(i.A,{className:f,tradingsymbol:t.symbol,exchange:t.exchange,qty:t.qty,avg:t.avg,ltp:n,direction:t.dir,compactViewOnly:!0}),r.createElement("div",{className:p},r.createElement("button",{className:0===h?d:"",onClick:()=>{g(0)}},"Exit"),r.createElement("button",{className:1===h?d:"",onClick:()=>{g(1)}},"Add Lots"),r.createElement("button",{className:2==h?d:"",onClick:()=>{g(2)}},"History")),0===h&&r.createElement(v,{positionToExit:t,ltp:n,exitPosition:l,doOnSuccessfulExit:a,closeDialog:m}),1===h&&r.createElement(s.O,{instrument:{token:t.token,symbol:t.symbol,name:t.name,expiry:t.expiry,exchange:t.exchange,lotSize:t.lotSize||1,broker:t.broker,strike:t.strike},ltp:n,enterPosition:o,doOnOpeningOrUpdatingPos:c,closeDialog:m}),2===h&&r.createElement(u,{pos:t}))}function v(e){let{positionToExit:t,ltp:n,exitPosition:i,doOnSuccessfulExit:s,closeDialog:c}=e;const{0:u,1:d}=(0,r.useState)(t.qty),{0:p,1:f}=(0,r.useState)(""),{0:E,1:y}=(0,r.useState)(!1),{notify:v}=(0,r.useContext)(m._),b=e=>isNaN(Number(e))?"Quantity should be a number":Number.isInteger(e)?e>t.qty?"Quantity cannot be more than "+t.qty:null!=t&&t.lotSize&&e<t.lotSize?"Quantity cannot be less than lot-size of "+t.lotSize:null!=t&&t.lotSize&&e%t.lotSize!=0?"Quantity should be a multiple of "+t.lotSize:"":"Quantity should be an integer",w=e=>{f(b(e)),d(e)};return r.createElement("div",{className:g},r.createElement("div",null,r.createElement(o.df,{title:"Exit Quantity",placeholder:"Exit Quantity",value:u,minValue:t.lotSize,maxValue:t.qty,stepSize:t.lotSize,onChange:e=>{w(Number(e.target.value))},onDecrement:w,onIncrement:w,error:p,info:t.lotSize&&u<t.qty&&u%t.lotSize==0?`${(u/t.qty*100).toFixed(1).replace(".0","")}% of total ${t.qty}`:""})),r.createElement("div",{className:h},null==n?"-.--":(0,l.kH)(n*u)),r.createElement("div",null,r.createElement(a.Ay,{variant:"tertiary",isDark:!0,onClick:c},"Cancel"),r.createElement(a.Ay,{variant:"primary",isDark:!0,onClick:async()=>{if(!n)return v("Error inferring exit price","err"),!1;const e=b(u);if(E)return!1;if(""!==e)return v(e,"err"),!1;try{if(y(!0),!await i(t.symbol,t.exchange,n,u,"S"===t.dir))throw new Error;return s&&"function"==typeof s&&s(t),v(`${t.symbol} position exited successfully`,"success"),c&&"function"==typeof c&&c(),!0}catch(r){return v(r.message||`Error exiting ${t.symbol} position`,"err"),!1}finally{y(!1)}},isWip:E,wipText:"Exiting"},"Exit Position")))}},8208:function(e,t,n){n.d(t,{A:function(){return h}});var r=n(6540),l=n(9611),a=n(7104),o=n(214),i=n(3654),s=n(1298),c="watchlistItem-module--instrumentCtaC--4b86d",u="watchlistItem-module--mainBtn--134bb",m="watchlistItem-module--nearExp--3fa9f",d="watchlistItem-module--wlItmC--923aa";function h(e){let{wrapperElement:t="div",tradingsymbol:n,entityName:h,exchange:g,ltp:p,closePrice:f,expiry:E,className:y,isExpandedView:v,isNotTradeable:b,onSellClick:w,onBuyClick:x,onRemoveClick:A,closeExpandedView:S,...k}=e;const{notify:N}=(0,r.useContext)(s._),C=void 0!==E&&"NSE"!==g&&"BSE"!==g?(0,o.RP)(new Date(E)):0;return r.createElement(t,Object.assign({className:`${d}${y&&"string"==typeof y&&""!==y.trim()?" "+y:""}`},k),r.createElement(a.A,{tradingsymbol:n,exchange:g}),r.createElement(l.A,{currentVal:p,baseVal:f}),r.createElement("span",{className:1===C?m:void 0},`${g}${h?" | "+h:""}`),r.createElement(l.A,{currentVal:100*(p-f)/f,baseVal:0}),v&&r.createElement("div",{className:c},r.createElement(i.Ay,{variant:"tertiary",isDark:!0,icon:"chevron-up",onClick:e=>{null==S||S(),e.stopPropagation()}}),!b&&r.createElement(r.Fragment,null,r.createElement(i.Ay,{variant:"sell",className:u,isDisabled:null===p||"number"!=typeof p,onClick:()=>{N("Sell functionality coming soon!")}},"SELL"),r.createElement(i.Ay,{variant:"buy",className:u,isDisabled:null===p||"number"!=typeof p,onClick:e=>{null!==p&&"number"==typeof p?(null==x||x(),null==S||S(),e.stopPropagation()):N("Error inferring tick price","err")}},"BUY")),r.createElement(i.Ay,{variant:"tertiary",isDark:!0,icon:"trash-2",onClick:e=>{null==A||A(),e.stopPropagation()}})))}},7486:function(e,t,n){n.d(t,{A:function(){return o}});var r=n(4506),l=n(6540),a=n(1381);function o(e,t,n,o,i,s,c){const u=(0,l.useContext)(a.M);function m(e,t){return t.filter((t=>!e.some((e=>(null==e?void 0:e.token)===(null==t?void 0:t.token)&&(null==e?void 0:e.exchange)===(null==t?void 0:t.exchange)))))}function d(e,t){return e.filter((e=>!t.some((t=>(null==t?void 0:t.token)===(null==e?void 0:e.token)&&(null==t?void 0:t.exchange)===(null==e?void 0:e.exchange)))))}const h=(0,l.useRef)([]);(0,l.useEffect)((()=>{const l=m(h.current,e);if(l.length>0){console.log("New positions added:",l);const e=m(t,l);e.length>0&&(console.log("WS-SUB-MANAGER: Positions to subscribe to WS:",e),(async()=>{await o(e)})())}const a=d(h.current,e);if(a.length>0){console.log("Positions removed:",a);const e=m(n?[].concat((0,r.A)(t),[n]):t,a);e.length>0&&(console.log("WS-UNSUB-MANAGER: Positions to unsubscribe from ws :",e),i(e))}h.current=e.map((e=>{let{token:t,exchange:n}=e;return{token:t,exchange:n}}))}),[e]);const g=(0,l.useRef)([]);(0,l.useEffect)((()=>{const l=m(g.current,t);if(l.length>0){console.log("New WL items added:",l);const t=m(e,l);t.length>0&&(console.log("WS-SUB-MANAGER: WL items to subscribe to WS:",t),(async()=>{await o(t)})())}const a=d(g.current,t);if(a.length>0){console.log("WL items removed:",a);const t=m(n?[].concat((0,r.A)(e),[n]):e,a);t.length>0&&(console.log("WS-UNSUB-MANAGER: WL items to unsubscribe from ws :",t),i(t))}g.current=t.map((e=>{let{token:t,exchange:n}=e;return{token:t,exchange:n}}))}),[t]);const p=(0,l.useRef)(null);(0,l.useEffect)((()=>{null!==n?([].concat((0,r.A)(e),(0,r.A)(t)).some((e=>{let{token:t,exchange:r}=e;return n.token===t&&n.exchange===r}))||(console.log("WS-SUB-MANAGER: Subscribe to "+n.symbol+" invoked for transaction"),(async()=>{await o([n])})()),p.current=n):null!==p.current&&([].concat((0,r.A)(e),(0,r.A)(t)).some((e=>{let{token:t,exchange:n}=e;return p.current.token===t&&p.current.exchange===n}))||(console.log("WS-UNSUB-MANAGER: Unsubscribe to "+p.current.symbol),i([{...p.current}])),p.current=null)}),[n]);const{0:f,1:E}=(0,l.useState)(!1),y=(0,l.useRef)(null),v=()=>{null!==y.current&&clearTimeout(y.current),setTimeout(E.bind(this,!1),3e3)},b=async()=>{if(console.log("WS-SUB-MANAGER: Trying to subscribe to quotes since WS is inactive"),E(!0),!(e.length>0||t.length>0||null!==n))return void v();const l=t.filter((t=>{let{token:n,exchange:r}=t;return!e.some((e=>e.token==n&&e.exchange===r))})),a=[].concat((0,r.A)(e),(0,r.A)(l));if(null!==n&&!a.some((e=>{let{token:t,exchange:r}=e;return n.token===t&&n.exchange===r}))&&a.push(n),a.length<1)return void v();await o(a)?v():(null!==y.current&&clearTimeout(y.current),y.current=setTimeout(b,3e3))},w=(0,l.useRef)(!1);return(0,l.useEffect)((()=>{c&&(w.current?(e.length>0||t.length>0||null!==n)&&2!=s?u?(console.log("WS-SUB-MANAGER: After coming back online or after waking up from sleep, we are resubscribing to quotes since WS is inactive"),(async()=>{await b()})()):(console.log("WS-SUB-MANAGER: Stopping retrying WS connection since offline"),v()):(console.log("WS-SUB-MANAGER: Stopping retrying since either no instruments need live-quotes or WS is already active and responding"),v()):w.current=!0)}),[u,s,c]),f}},6660:function(e,t,n){n.d(t,{A:function(){return a}});var r=n(6540),l=n(1381);function a(e,t,n){const a=(0,r.useContext)(l.M),o=(0,r.useRef)(a),{0:i,1:s}=(0,r.useState)(0),c=(0,r.useRef)(i),{0:u,1:m}=(0,r.useState)(0),d=(0,r.useRef)(null),h=(0,r.useRef)(null),g=(0,r.useRef)(null),p=(0,r.useRef)(null),f=(e,t)=>{null!==p.current&&clearTimeout(p.current),t?(s(e),p.current=null):p.current=setTimeout((()=>{s(e),p.current=null}),1e3)},E=async()=>{var r;if(!o.current)return null;if(1===(null===(r=d.current)||void 0===r?void 0:r.readyState)){if(2===c.current)return d.current;y()}if("function"!=typeof e&&"string"!=typeof e)return console.error("Cannot understand how to infer socket URL"),null;console.log("WS: Opening new socket");const l="function"==typeof e?await e():e;return l&&""!==(null==l?void 0:l.trim())?new Promise(((e,r)=>{if(!o.current)return r(null);try{const a=new WebSocket(l);a.onopen=()=>{var t,r,l,o;(d.current=a,f(1),console.log("Socket connection established"),n&&"number"==typeof n)&&(d.current.send("ping"),g.current&&(null===(t=window)||void 0===t||null===(r=t.clearInterval)||void 0===r||r.call(t,g.current)),g.current=null===(l=window)||void 0===l||null===(o=l.setInterval)||void 0===o?void 0:o.call(l,(()=>{var e;1===(null===(e=d.current)||void 0===e?void 0:e.readyState)&&d.current.send("ping")}),29e3));e(a)},a.onclose=e=>{var t,n;f(0),m(0),d.current=null,null!==g.current&&(null===(t=window)||void 0===t||null===(n=t.clearInterval)||void 0===n||n.call(t,g.current)),r(null)},a.onerror=()=>{var e,t;1!==a.readyState&&(f(0),m(0),d.current=null,null!==g.current&&(null===(e=window)||void 0===e||null===(t=e.clearInterval)||void 0===t||t.call(e,g.current)))},a.onmessage=e=>{var n,r,l,a;(f(2,!0),null!==h.current)&&(null===(l=window)||void 0===l||null===(a=l.clearTimeout)||void 0===a||a.call(l,h.current),console.log("WS: Retry timer cleared on receipt of a response"));h.current=null,("string"==typeof e.data||"Blob"==(null===(n=e.data)||void 0===n?void 0:n.constructor.name)&&(null===(r=e.data)||void 0===r?void 0:r.size)>1)&&(null==t||t(e.data).then((e=>{e&&m((e=>e+1))})))}}catch(a){f(0),m(0),r(null)}})):(console.error("Error inferring socket URL"),null)},y=()=>{var e,t,n,r,l;null===(e=d.current)||void 0===e||e.close(),d.current=null,f(0,!0),m(0),null!==h.current&&(null===(t=window)||void 0===t||null===(n=t.clearTimeout)||void 0===n||n.call(t,h.current)),h.current=null,null!==g.current&&(null===(r=window)||void 0===r||null===(l=r.clearInterval)||void 0===l||l.call(r,g.current))},v=e=>{if(!e||null==e)return!1;try{var t,n,r,l,a;if(Array.isArray(e))e.forEach((e=>{var t;return null===(t=d.current)||void 0===t?void 0:t.send(e)}));else null===(a=d.current)||void 0===a||a.send(e);return null!==h.current&&(null===(t=window)||void 0===t||null===(n=t.clearTimeout)||void 0===n||n.call(t,h.current)),h.current=null===(r=window)||void 0===r||null===(l=r.setTimeout)||void 0===l?void 0:l.call(r,(()=>{E().then((t=>{if(!t)throw new Error;o.current&&v(e)})).catch((e=>{console.error(e.message||"Error creating auxilary socket connection")}))}),9e3),console.log("WS: Retry timer set"),!0}catch(i){return!1}};return(0,r.useEffect)((()=>(o.current=a,!a&&null!==d.current&&y(),y)),[a]),(0,r.useEffect)((()=>{c.current=i}),[i]),{socketStatus:i,tick:u,sendData:async(e,t,n)=>{if(!e||null==e)return!1;if(!o.current)return!1;if(Array.isArray(e)&&e.length<1)return!1;try{var r,l;if(1==(null===(r=d.current)||void 0===r?void 0:r.readyState))return n?v(e):(Array.isArray(e)?e.forEach((e=>{var t;return null===(t=d.current)||void 0===t?void 0:t.send(e)})):null===(l=d.current)||void 0===l||l.send(e),!0);if(t){if(!await E())return!1;if(n)return v(e);var a;Array.isArray(e)?e.forEach((e=>{var t;return null===(t=d.current)||void 0===t?void 0:t.send(e)})):null===(a=d.current)||void 0===a||a.send(e)}return!0}catch(i){return!1}}}}},8583:function(e,t,n){n.d(t,{A:function(){return s},I:function(){return i}});var r=n(6540),l=n(1298),a=n(117),o=n(5946);const i=(0,r.createContext)({positionsGet:async()=>{},positionEnter:async(e,t,n,r,l,a,o)=>{},positionExit:async(e,t,n,r,l)=>{},watchlistInstrumentsGet:async e=>{},watchlistInstrumentAdd:async(e,t,n,r)=>{},watchlistInstrumentAddMultiple:async(e,t)=>{},watchlistInstrumentRemove:async(e,t,n)=>{},watchlistClear:e=>{}});function s(e){let{currentBrokerCode:t,masterData_getInstrument:n,masterData_getInstruments:s,children:c}=e;const{notify:u}=(0,r.useContext)(l._),{id:m,checkIfPlanActive:d}=(0,r.useContext)(a.R),{getPosition:h,setPosition:g,exitPosition:p,getWatchlistInstruments:f,setWatchlistInstrument:E,setWatchlistMultipleInstruments:y,deleteWatchlistInstrument:v,clearWatchlist:b}=(0,r.useContext)(o.s);return r.createElement(i.Provider,{value:{positionsGet:async()=>{try{const e=await h(null,null,null,null);if(!e||(null==e?void 0:e.length)<1)throw null;const t=e.reduce(((e,t)=>(e[t.xh]||(e[t.xh]=[]),e[t.xh].push(t.sbl),e)),{}),n=await s(t);if(!n)throw new Error("Error resolving instruments from master database");const{instrumentsFound:r,instrumentsNotFound:l}=n,a=r.map((t=>{const n=e.find((e=>e.sbl===t.symbol));return{token:t.token,symbol:n.sbl,name:(null==t?void 0:t.name)||(null==n?void 0:n.nm),exchange:n.xh,avg:n.avg,qty:n.qty,lotSize:null==t?void 0:t.lotSize,t:n.t,expiry:null==n?void 0:n.x,dir:n.dir,broker:"z"===n.bkr?"Zerodha":"us"===n.bkr?"Upstox":"5p"===n.bkr?"5paisa":"Angel One",h:null==n?void 0:n.h}}));return{positionsFound:a,positionsNotFound:l.map((t=>{const n=e.find((e=>e.sbl===t.symbol));return{...t,expiry:(null==n?void 0:n.x)||null,broker:"z"===n.bkr?"Zerodha":"us"===n.bkr?"Upstox":"5p"===n.bkr?"5paisa":"Angel One"}}))}}catch(e){return e&&(console.error(`APP-DATA-MASTER-DATA_JOIN: positionsGet(): ${e.message||"Error"}`),u(e.message||"Failed to read positions","err")),{positionsFound:[],positionsNotFound:[]}}},positionEnter:async(e,r,l,a,o,i,s)=>{try{if(!await d())throw new Error("Plan Expired");const i=await n(r,e);if(!i)throw new Error(`Error inferring instrument data for ${e} while opening position`);if(Object.hasOwn(i,"isNotTradeable")&&i.isNotTradeable)throw new Error(`Instrument ${e} is not tradeable`);if(i.lotSize&&a<i.lotSize||a%i.lotSize!=0)throw new Error(`Quantity ${a} is invalid for lot-size of ${i.lotSize}`);const s=await g(e,r,l,a,t,"B"===o?"B":"S",Object.hasOwn(i,"expiry")&&i.expiry?i.expiry:void 0).catch((e=>{throw e}));if(!s)throw new Error("Failed to open or update position");return{positionStored:s,instrument:i}}catch(c){if(c&&["Plan Expired","Instrument expired","Insufficient wallet balance","Space unavailable"].includes(c))throw c;return console.error(`APP-DATA-MASTER-DATA_JOIN: positionEnter(): ${c.message||c||"Error"}`),u(c.message||"Failed to open or update position","err"),null}},positionExit:async(e,n,r,l,a)=>{try{if(!await d())throw new Error("Plan Expired");const o=await p(e,n,a||!1,r,l,t);if(!o)throw new Error("Failed to exit position");return o}catch(o){return console.error(`APP-DATA-MASTER-DATA_JOIN: positionExit(): ${o.message||"Error"}`),u(o.message||"Failed to exit position","err"),null}},watchlistInstrumentsGet:async e=>{try{const t=await f(e);if(!t||(null==t?void 0:t.length)<1)throw null;const n=t.reduce(((e,t)=>(e[t.xh]||(e[t.xh]=[]),e[t.xh].push(t.sbl),e)),{}),r=await s(n);if(!r)throw new Error("Error resolving instruments from master database");const{instrumentsFound:l,instrumentsNotFound:a}=r,o=l.map((e=>{const n=t.find((t=>t.sbl===e.symbol));return{...e,broker:"z"===n.bkr?"Zerodha":"us"===n.bkr?"Upstox":"5p"===n.bkr?"5paisa":"Angel One"}}));return{instrumentsFound:o,instrumentsNotFound:a.map((e=>{const n=t.find((t=>t.sbl===e.symbol));return{...e,expiry:(null==n?void 0:n.x)||null,broker:"z"===n.bkr?"Zerodha":"us"===n.bkr?"Upstox":"5p"===n.bkr?"5paisa":"Angel One"}}))}}catch(t){return t&&(console.error(`APP-DATA-MASTER-DATA_JOIN: watchlistInstrumentsGet(): ${t.message||"Error"}`),u(t.message||"Failed to read watchlist instruments","err")),{instrumentsFound:[],instrumentsNotFound:[]}}},watchlistInstrumentAdd:async(e,n,r,l)=>{try{return!!await E(e,n,r,l,t).catch((e=>{"Space unavailable"===(null==e?void 0:e.message)&&u("Watchlist is full","err")}))}catch(a){return!1}},watchlistInstrumentAddMultiple:async(e,t)=>{try{if(!await d())throw new Error("Plan Expired");return await y(e,t).catch((e=>{"Space unavailable"===(null==e?void 0:e.message)&&u("Watchlist cannot store as many instruments","err")}))}catch(n){return!1}},watchlistInstrumentRemove:v,watchlistClear:b}},c)}},1291:function(e,t,n){n.d(t,{A:function(){return I}});var r=n(4506),l=n(6540),a=n(1298),o=n(1381),i=n(117),s=n(8583),c=n(7432),u=n(3654),m=n(6399),d=n(9354),h=n(7104),g=n(214),p="watchlistSearchResultsMultiselect-module--isSelected--ac19a",f="watchlistSearchResultsMultiselect-module--nearExp--fb004",E="watchlistSearchResultsMultiselect-module--searchListFtr--49fd2",y="watchlistSearchResultsMultiselect-module--searchListMultiselectC--920ed",v="watchlistSearchResultsMultiselect-module--srchItemExpired--db4e0";function b(e){let{instrumentsAry:t,instrumentTokenAryToIgnoreSelecting:n,isWip:a,doBeforeItemSelect:o,doOnItemSelectDeselect:i,doOnCancel:s,acceptBtnText:d,doOnAccept:b}=e;const{0:w,1:x}=(0,l.useState)([]);return(0,l.useEffect)((()=>{x([])}),[t]),l.createElement(l.Fragment,null,l.createElement("div",{className:y},t&&t.length>0?t.map(((e,t)=>{let{token:a,symbol:s,exchange:c,expiry:u}=e;const m=null!=u&&"NSE"!==c&&"BSE"!==c?(0,g.RP)(new Date(u)):0;if(2===m)return l.createElement("div",{className:v,key:a+"_x"},l.createElement(h.A,{tradingsymbol:s,exchange:c}));const d=n&&n.includes(a),E=!d&&w.includes(a);return l.createElement("button",{key:`${a}${t}${E?"y":"n"}`,onClick:()=>{!d&&2!==m&&(e=>{const t=(0,r.A)(w);if(t.includes(e)){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}else o&&"function"==typeof o?o(e,w.length)&&t.push(e):t.push(e);x(t),i&&"function"==typeof i&&i(t)})(a)},className:E?p:null,disabled:d?"disabled":""},l.createElement(h.A,{tradingsymbol:s,exchange:c}),1==m&&l.createElement("span",{className:f}),!d&&l.createElement("span",null))})):!a&&l.createElement(m.A,{icon:"search",note:"No Instruments Found",isOverlay:!0}),a&&l.createElement(c.A,{note:"Searching"})),t&&t.length>0&&l.createElement("div",{className:E},l.createElement(u.Ay,{variant:"primary",isDark:!0,onClick:b.bind(this,w),isDisabled:w.length<1||a},d||"Accept Selected"),l.createElement(u.Ay,{variant:"tertiary",isDark:!0,onClick:s},"Cancel")))}var w=n(6428),x=n(6654),A="marketWatchTemplate-module--active--646b2",S="marketWatchTemplate-module--marketWatchC--06b28",k="marketWatchTemplate-module--marketWatchHdr--d69d7",N="marketWatchTemplate-module--marketWatchHdrTitleBar--1629a",C="marketWatchTemplate-module--marketWatchMain--6d17c",F="marketWatchTemplate-module--watchListFtr--02dee",P="marketWatchTemplate-module--watchlistC--1d9d3",O="marketWatchTemplate-module--watchlistTabsC--47338";function I(e){let{currentBroker:t,currentBrokerCode:n,isMasterDataReady:h,socketStatus:g,isSocketRetryWip:p,watchlistInstrumentsAry:f,setWatchlistInstrumentsAry:E,searchFilterExchangesAry:y,searchInstruments:v,children:I}=e;const{notify:T}=(0,l.useContext)(a._),D=(0,l.useContext)(o.M),{id:B,checkIfPlanActive:M}=(0,l.useContext)(i.R),{watchlistInstrumentsGet:R,watchlistInstrumentAdd:$,watchlistInstrumentAddMultiple:W,watchlistInstrumentRemove:L,watchlistClear:q}=(0,l.useContext)(s.I),{0:z,1:U}=(0,l.useState)(!1),{0:H,1:_}=(0,l.useState)(0),{0:V,1:G}=(0,l.useState)([]),{0:Q,1:j}=(0,l.useState)({}),{0:Z,1:J}=(0,l.useState)(!1),Y=(0,l.useCallback)((async()=>{try{await M();const e=await R(H+1);if((!Object.hasOwn(e,"instrumentsFound")||e.instrumentsFound.length<1)&&(!Object.hasOwn(e,"instrumentsNotFound")||e.instrumentsNotFound.length<1))throw U(!0),T(`Watchlist-${H+1} is empty`),null;Object.hasOwn(e,"instrumentsNotFound")&&e.instrumentsNotFound.length>0?(G(e.instrumentsNotFound),T(e.instrumentsNotFound.length+" instruments not loaded!","err")):G([]),Object.hasOwn(e,"instrumentsFound")&&e.instrumentsFound.length>0?E(e.instrumentsFound):(E([]),U(!0))}catch(e){return e&&console.error("MARKETWATCH TEMPLATE: load watchlist():",e.message||e),D&&f.length>0&&E([]),G([]),j({}),U(!0),null}}),[B,f,H,D]),X=(0,l.useCallback)((async e=>{if(!e||!Array.isArray(e)||e.length<1)return!1;const t="10"-(f.length+V.length);if(e.length>t)return T("Only "+t+" more instruments can be added to watchlist-"+(H+1)),!1;try{if(!await M())throw new Error("Plan Expired!");const t=e.map((e=>{const t={sbl:e.symbol,xh:e.exchange,bkr:n};return null!=e&&e.expiry&&(t.x=e.expiry),t}));if(!await W(H+1,t))return!1;const l=e.map((e=>({...e,broker:"Upstox"}))),a=(0,r.A)(f);for(const e of l){a.some((t=>t.token===e.token))||a.push(e)}return E(a),!0}catch(l){return T(l.message||"Error adding instruments to watchlist","err"),!1}}),[B,f,V,H,D]),K=(0,l.useCallback)((async(e,t,n)=>{if(!e||"string"!=typeof e||""===e.trim())return!1;if(!t||"string"!=typeof t||""===t.trim())return!1;try{if(!await M())throw new Error("Plan Expired!");return!!await L(H+1,e,t)&&(E(f.filter((n=>{let{symbol:r,exchange:l}=n;return!(r===e&&l===t)}))),j({}),!0)}catch(r){return!1}}),[B,f,H]),ee=(0,l.useCallback)((async(e,t)=>{if(!e||"string"!=typeof e||""===e.trim())return!1;if(!t||"string"!=typeof t||""===t.trim())return!1;try{return!!await L(H+1,e,t)&&(G(V.filter((n=>{let{symbol:r,exchange:l}=n;return!(r===e&&l===t)}))),!0)}catch(n){return!1}}),[B,V,H]),te=(0,l.useCallback)((async()=>{if(f.length<1)return!0;try{return!!await q(H+1)&&(E([]),G([]),j({}),!0)}catch(e){return!1}}),[B,f,H]),{0:ne,1:re}=(0,l.useState)(""),{0:le,1:ae}=(0,l.useState)(!1),{0:oe,1:ie}=(0,l.useState)([]),se=(0,l.useCallback)((async(e,t,n,r,l,a)=>{const o=await v(e,t,n,r,l,a,20);return ae(!1),!o||(null==o?void 0:o.length)<1?(ie([]),T("No Instruments found under "+e,"alert"),!1):(Array.isArray(o)&&ie(o),!0)}),[]);(0,l.useEffect)((()=>{(async()=>{await M(),h&&await Y()})()}),[H,h]);const ce=(0,l.useMemo)((()=>f.map((e=>{let{token:t}=e;return t}))),[f]);return(0,l.useEffect)((()=>{2===g&&U(!0)}),[g]),l.createElement(l.Fragment,null,l.createElement("div",{className:S},l.createElement("div",{className:C},l.createElement("div",{className:k},l.createElement("div",{className:N},l.createElement("h3",null,`Watchlist-${H+1}`),f.length>1&&l.createElement(u.Ay,{variant:"tertiary",isDark:!0,icon:"broom-clean",onClick:J.bind(this,!0)})),l.createElement(d.A,{placeholderText:`Add to Watchlist-${H+1}`,searchQuery:ne,setSearchQuery:re,exchangesAry:y,doOnExitSearchMode:ie.bind(this,[]),doSearch:se,doBeforeSearchStarts:ae.bind(this,!0),note:Number(f.length+V.length)+" / 10",isDisabled:f.length+V.length>="10"})),""!==ne.trim()?l.createElement(b,{instrumentsAry:oe,instrumentTokenAryToIgnoreSelecting:ce,isWip:le,doBeforeItemSelect:(e,t)=>!(f.length+V.length+t>="10")||(T(`Max 10 instruments can be shown in watchlist-${H+1}`),!1),doOnCancel:()=>{re(""),ie([]),ae(!1)},acceptBtnText:`Add to Watchlist-${H+1}`,doOnAccept:e=>{(async()=>{await X(oe.filter((t=>{let{token:n}=t;return e.includes(n)}))),re(""),ie([]),ae(!1)})()}}):l.createElement(l.Fragment,null,l.createElement("div",{className:P},h&&z&&(f.length>0||V.length>0?l.createElement(l.Fragment,null,f.length>0&&I&&"function"==typeof I&&I(K,Q,j),V.length>0&&l.createElement(w.A,{instrumentsNotFoundAry:V,currentBroker:t,onItemDeleteBtnClick:ee})):l.createElement(m.A,{icon:"binocular",note:`Watchlist-${H+1} is empty`,isOverlay:!0}))),l.createElement("div",{className:F},l.createElement("div",{className:O},[1,2,3,4,5,6].map(((e,t)=>l.createElement("button",{key:e,className:t===H?A:"",onClick:_.bind(this,t)},e))))))),D?h&&(z?p?l.createElement(c.A,{note:"Reconnecting"}):0===g?f.length>0&&l.createElement(m.A,{icon:"alert-circle",note:"Connection to live data interrupted",ctaFn:async()=>{E([]),await Y()},ctaBtnText:"Reconnect",isOverlay:!0}):1===g&&l.createElement(c.A,{note:"Fetching live quotes"}):l.createElement(c.A,{note:"Loading Watchlist"})):l.createElement(m.A,{icon:"alert-circle",note:"Network unavailable",isOverlay:!0})),Z&&l.createElement(x.A,{confirmationNote:"Confirm clearing entire watchlist?",doOnClose:()=>{J(!1)},doOnConfirm:te,confirmBtnText:"Clear All"}))}},7765:function(e,t,n){n.d(t,{A:function(){return R}});var r=n(4506),l=n(6540),a=n(1298),o=n(1381),i=n(117),s=n(8583),c=n(7432),u=n(9552),m=n(3654),d=n(2488),h=n(6399),g=n(9611),p=n(9354),f=n(7104),E=n(214),y="searchListItem-module--nearExp--5ef34",v="searchListItem-module--srchItem--233a9";function b(e){let{symbol:t,exchange:n,expiry:r,extraDetail:a,className:o,...i}=e;const s=r?(0,E.RP)(new Date(r)):0;return 2===s?l.createElement("div",Object.assign({className:`${v}${o&&"string"==typeof o&&""!==o.trim()?" "+o:""}`},i),l.createElement(f.A,{tradingsymbol:t,exchange:n}),a&&l.createElement("div",null,a)):l.createElement("button",Object.assign({className:`${v}${1===s?" "+y:""}${o&&"string"==typeof o&&""!==o.trim()?" "+o:""}`},i),l.createElement(f.A,{tradingsymbol:t,exchange:n}),a&&l.createElement("div",null,a))}var w=n(6428);function x(e){let{dataAry:t,size:n=100,strokeWidth:r=20,gapDegrees:a=2}=e;const o=(n-r)/2,i=n/2,s=a*Math.PI/180;let c=0;return l.createElement("svg",{width:"100",height:"100",viewBox:"0 0 100 100",style:{transform:"rotate(-0.25turn)"}},t.filter((e=>e.prcnt>3)).map(((e,t)=>{const n=(null==e?void 0:e.color)||`hsl(${60*t}, 80%, 70%)`,a=e.prcnt/100;let u=2*c*Math.PI,m=2*(c+a)*Math.PI;u+=s/2,m-=s/2;const d=i+o*Math.cos(u),h=i+o*Math.sin(u),g=i+o*Math.cos(m),p=i+o*Math.sin(m),f=m-u>Math.PI?1:0;return c+=a,l.createElement("path",{key:`donut${Math.round(e.prcnt)}${t}`,d:`M ${d.toFixed(2)} ${h.toFixed(2)} A ${o.toFixed(2)} ${o.toFixed(2)} 0 ${f} 1 ${g.toFixed(2)} ${p.toFixed(2)}`,fill:"none",stroke:n,strokeWidth:r})})))}var A=(0,l.memo)(x),S="positionsStats-module--positionsStatsT--2a2e4";function k(e){let{positionsAry:t,calcPnlPerExchangeType:n}=e;if(t.length<1)return l.createElement("div",null,"You do not have any open positions!");const r=(0,l.useMemo)((()=>{const e={eq:{total:0,prcnt:0},fno:{total:0,prcnt:0},com:{total:0,prcnt:0},cds:{total:0,prcnt:0},totalInfused:0};return t.forEach((t=>{switch(t.exchange){case"NSE":case"BSE":e.eq.total+=t.qty*t.avg;break;case"NFO":e.fno.total+=t.qty*t.avg;break;case"MCX":e.com.total+=t.qty*t.avg;break;case"CDS":e.cds.total+=t.qty*t.avg}})),e.totalInfused=e.eq.total+e.fno.total+e.com.total+e.cds.total,e.eq.total>0&&(e.eq.prcnt=100*e.eq.total/e.totalInfused),e.fno.total>0&&(e.fno.prcnt=100*e.fno.total/e.totalInfused),e.com.total>0&&(e.com.prcnt=100*e.com.total/e.totalInfused),e.cds.total>0&&(e.cds.prcnt=100*e.cds.total/e.totalInfused),e}),[t]),a=(null==n?void 0:n())||{eq:null,fno:null,com:null,cds:null,total:null},o=["#a084f5","#7ed5f5","#93f053","#f5d67e","#e55959"],i=(0,l.useMemo)((()=>0===r.totalInfused?null:Object.keys(r).slice(0,-1).reduce(((e,t,n)=>(e.push({prcnt:r[t].prcnt||0,color:o[n]||"#f00"}),e)),[])),[t]),s=(0,l.useMemo)((()=>{const e=Object.keys(a).slice(0,-1);let t=0;return e.forEach((e=>{const n=a[e]||0;t+=n>0?n:0})),e.reduce(((e,n,r)=>{const l=a[n]||0;return e.push({prcnt:l>0?100*l/t:0,color:o[r]||"#f00"}),e}),[])}),[t]);return l.createElement("table",{className:S},l.createElement("colgroup",null,l.createElement("col",{style:{width:"20%"}}),l.createElement("col",{style:{width:"40%"}}),l.createElement("col",{style:{width:"40%"}})),l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"Type"),l.createElement("th",null,"Capital",l.createElement("br",null),"Infused"),l.createElement("th",null,"Floating",l.createElement("br",null),"P & L"))),l.createElement("tbody",null,l.createElement("tr",null,l.createElement("td",null),l.createElement("td",null,i&&l.createElement(A,{dataAry:i})),l.createElement("td",null,s&&l.createElement(A,{dataAry:s}))),l.createElement(N,{label:"Equity",capitalInfused:r.eq.total,capitalInfused_prcnt:r.eq.prcnt,profit:a.eq,color:o[0]}),l.createElement(N,{label:"Fut & Opt",capitalInfused:r.fno.total,capitalInfused_prcnt:r.fno.prcnt,profit:a.fno,color:o[1]}),l.createElement(N,{label:"Commodity",capitalInfused:r.com.total,capitalInfused_prcnt:r.com.prcnt,profit:a.com,color:o[2]}),l.createElement(N,{label:"Currency",capitalInfused:r.cds.total,capitalInfused_prcnt:r.cds.prcnt,profit:a.cds,color:o[3]})),l.createElement("tfoot",null,l.createElement("tr",null,l.createElement("td",null,"Total"),l.createElement("td",null,(0,E.kH)(r.totalInfused)),l.createElement("td",null,l.createElement(g.A,{currentVal:a.total,baseVal:0})))))}function N(e){let{label:t,capitalInfused:n,capitalInfused_prcnt:r,profit:a,color:o}=e;return l.createElement("tr",null,0===n?l.createElement(l.Fragment,null,l.createElement("td",null,t),l.createElement("td",null),l.createElement("td",null)):l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("span",{style:{color:o}},t)),l.createElement("td",{"data-prcnt":Math.round(r)},(0,E.kH)(n)),l.createElement("td",null,l.createElement(g.A,{currentVal:a,baseVal:0}))))}var C=n(998),F=n(4488),P="positionsTemplate-module--depositReqC--06649",O="positionsTemplate-module--posSearchResultsListC--59ef4",I="positionsTemplate-module--positionsC--ca161",T="positionsTemplate-module--positionsFtr--37519",D="positionsTemplate-module--positionsHdr--e2926",B="positionsTemplate-module--positionsWipInfoC--d3d09",M="positionsTemplate-module--totalPnL--03662";function R(e){let{currentBroker:t,currentBrokerCode:n,isMasterDataReady:f,socketStatus:E,isSocketRetryWip:y,positionsAry:v,setPositionsAry:x,instrumentInvokedForTransaction:A,invokeInstrumentForTransaction:S,renderNewPosDialog:N,posInvokedForViewingDetailsOrExiting:R,renderPosMgmtDialog:$,totalPnL:W,calcPnlPerExchangeType:L,searchFilterExchangesAry:q,searchInstruments:z,children:U}=e;const{notify:H}=(0,l.useContext)(a._),_=(0,l.useContext)(o.M),{id:V,checkIfPlanActive:G,checkIfLoginSessionIsValid:Q}=(0,l.useContext)(i.R),{positionsGet:j,positionEnter:Z,positionExit:J}=(0,l.useContext)(s.I),{0:Y,1:X}=(0,l.useState)(!1),{0:K,1:ee}=(0,l.useState)([]),{0:te,1:ne}=(0,l.useState)(!1),{walletBalance:re,cumulativeDeposit:le,reFetch:ae}=(0,F.A)(),oe=async()=>{try{var e,t,n;await G();const r=await j();if((!Object.hasOwn(r,"positionsFound")||(null===(e=r.positionsFound)||void 0===e?void 0:e.length)<1)&&(!Object.hasOwn(r,"positionsNotFound")||(null===(t=r.positionsNotFound)||void 0===t?void 0:t.length)<1))throw X(!0),H("No open positions"),null;(null==r||null===(n=r.positionsNotFound)||void 0===n?void 0:n.length)>0?(ee(r.positionsNotFound),H(r.positionsNotFound.length+" positions could not be loaded")):ee([]),r.positionsFound.length>0?x(r.positionsFound):X(!0)}catch(r){return r&&console.error("POSITIONS TEMPLATE: load positions():",r.message||r),x([]),ee([]),X(!0),null}},ie=async(e,t,n,r,l,a,o)=>{try{if(!await G())throw new Error("Plan Expired!");const i=await Z(e,t,n,r,l,a,o).catch((e=>{throw e}));if(!i)throw new Error;return se(i.positionStored,i.instrument),H(`Position entered successfully for ${e}`,"success"),!0}catch(i){if(i){if(["Plan Expired","Insufficient wallet balance","Space unavailable"].includes(i))return H(i,"alert"),null;console.error("POSITIONS TEMPLATE: enterPosition():",i.message||i)}return!1}},se=(e,n)=>{if(v.find((t=>t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir)))x(v.map((t=>(t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir&&(t.qty=e.qty,t.avg=e.avg,t.h=e.h),t))));else{const l={symbol:e.sbl,name:null==e?void 0:e.nm,exchange:e.xh,avg:e.avg,qty:e.qty,t:e.t,dir:e.dir,broker:t,token:n.token,h:[[Date.now(),e.qty,e.avg]]};null!=n&&n.lotSize&&(l.lotSize=n.lotSize),null!=n&&n.expiry&&(l.expiry=n.expiry),null!=e&&e.sl&&(l.sl=e.sl),null!=e&&e.tp&&(l.tp=e.tp),x([l].concat((0,r.A)(v)))}},ce=e=>{const t=v.find((t=>t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir));t&&(t.qty===e.qty?x(v.filter((t=>!(t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir)))):e.qty<t.qty&&x(v.map((t=>(t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir&&(t.qty=t.qty-e.qty,t.h=Object.hasOwn(t,"h")&&t.h&&Array.isArray(t.h)?[[Date.now(),-1*e.qty,e.cp]].concat((0,r.A)(t.h)):[[Date.now(),-1*e.qty,e.cp]]),t)))))},{0:ue,1:me}=(0,l.useState)(""),{0:de,1:he}=(0,l.useState)(!1),{0:ge,1:pe}=(0,l.useState)([]),fe=(0,l.useCallback)((async(e,t,n,r,l,a)=>{const o=await z(e,t,n,r,l,a,20);return he(!1),!o||(null==o?void 0:o.length)<1?(pe([]),H("No Instruments found under "+e,"alert"),!1):(Array.isArray(o)&&pe(o),!0)}),[]);(0,l.useEffect)((()=>{(async()=>{await G(),f&&await oe()})()}),[f]),(0,l.useEffect)((()=>{2===E&&X(!0)}),[E]);const Ee=(0,l.useRef)(!1);return(0,l.useEffect)((()=>{Ee.current?ae():Ee.current=!0}),[v]),l.createElement(l.Fragment,null,f&&Y&&(re<=0&&v.length<1&&K.length<1?l.createElement("div",{className:P},l.createElement(u.A,{icon:"wallet"}),l.createElement("div",null,l.createElement("h3",null,"Helps you keep track of your account progress and growth"),l.createElement("p",null,"Start away by depositing certain virtual amount in your wallet, which you shall utilize when entering positions")),l.createElement(d.A,{showVirtualAmtNotice:!0,doOnDeposit:e=>{ae()}})):l.createElement("div",{className:I},l.createElement("div",{className:D},l.createElement(p.A,{placeholderText:"New Position",searchQuery:ue,setSearchQuery:me,exchangesAry:q,doOnExitSearchMode:pe.bind(this,[]),doSearch:fe,doBeforeSearchStarts:he.bind(this,!0),note:Number(v.length+K.length)+" / 20",isDisabled:v.length+K.length>="20"})),""===ue.trim()?l.createElement(l.Fragment,null,v.length>0&&(null==U?void 0:U.length)&&l.createElement(l.Fragment,null,l.createElement("div",null,U),l.createElement("div",{className:T},l.createElement(m.Ay,{variant:"tertiary",isDark:!0,size:"small",icon:"pie-chart",onClick:()=>ne(!0)},"Stats"),l.createElement("span",{className:M},"Net: ",l.createElement(g.A,{currentVal:W,baseVal:0})))),K.length>0&&l.createElement(w.A,{instrumentsNotFoundAry:K,currentBroker:t,title:"Positions not found",description:"Following positions opened through different broker"})):ge.length>0&&l.createElement(l.Fragment,null,l.createElement("div",{className:O},ge.map(((e,t)=>l.createElement(b,{key:`${e.token}${t}`,symbol:e.symbol,exchange:e.exchange,expiry:e.expiry,extraDetail:e.name,onClick:()=>{(async()=>{await S(e,!1)})()}})))),l.createElement("div",{className:T},l.createElement("span",null),l.createElement(m.Ay,{variant:"tertiary",isDark:!0,icon:"arrow-left",onClick:me.bind(this,"")},"Back to Positions"))))),l.createElement("div",{className:B},""!==ue.trim()?de?l.createElement(c.A,{note:"Searching"}):ge.length<1&&l.createElement(h.A,{icon:"search",note:"No Instruments found for your query",ctaFn:me.bind(this,""),ctaBtnText:"Back to Positions",isOverlay:!0}):_?f&&(Y?v.length<1?K.length<1&&re>0&&l.createElement(h.A,{icon:"briefcase",note:"No Open Positions"}):y?l.createElement(c.A,{note:"Reconnecting"}):0===E?l.createElement(h.A,{icon:"alert-circle",note:"Connection to live data interrupted",ctaFn:async()=>{x([]),await oe()},ctaBtnText:"Reconnect",isOverlay:!0}):1===E&&l.createElement(c.A,{note:"Fetching live quotes"}):l.createElement(c.A,{note:"Loading Positions"})):l.createElement(h.A,{icon:"alert-circle",note:"Network unavailable",isOverlay:!0})),R&&$&&"function"==typeof $&&$((async(e,t,n,r,l)=>{try{if(!await Q())return!1;await G();const a=await J(e,t,n,r,l).catch((e=>{console.error(e)}));if(!a)throw new Error;return ce(a),!0}catch(a){return console.error(a),!1}}),ie),A&&N&&"function"==typeof N&&N(ie,me.bind(this,"")),te&&l.createElement(C.A,{doOnClose:()=>ne(!1),title:"Positions Stats"},l.createElement("div",null,l.createElement(k,{positionsAry:v,calcPnlPerExchangeType:L}))))}},8244:function(e,t,n){n.d(t,{A:function(){return u}});var r=n(6540),l=n(7840),a="loginHero-module--infoC--c3fac",o="loginHero-module--loginHeroBanner--57e3a",i="loginHero-module--svgC--3b6fe",s="loginHero-module--svgL--0aa81",c="loginHero-module--svgR--1165a";function u(e){return r.createElement("div",Object.assign({className:o},e),r.createElement("div",{className:i},r.createElement("svg",{className:s,version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1120 880"},r.createElement("use",{href:"#svgGrass",x:"0",y:"0",width:"824",height:"824"}),r.createElement("use",{href:"#svgLeaf",x:"-120",y:"80",width:"232",height:"580"}),r.createElement("use",{href:"#svgLeaf",x:"136",y:"368",width:"144",height:"360",opacity:"0.5"})),r.createElement("svg",{className:c,version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1120 880"},r.createElement("use",{href:"#svgHeroMainBlob",x:"80",y:"-52",width:"1200",height:"960",opacity:"0.5"}),r.createElement("use",{href:"#svgHeroMainBlob",x:"200",y:"16",width:"1120",height:"800"}),r.createElement("clipPath",{id:"svgHeroMainBlobPathClip"},r.createElement("use",{href:"#svgHeroMainBlobPath",x:"200",y:"16"}),r.createElement("use",{href:"#svgHeroMainBlobPath",x:"80",y:"8"})),r.createElement("g",{clipPath:"url(#svgHeroMainBlobPathClip)"},r.createElement("use",{href:"#svgLeaf",x:"900",y:"440",width:"130",height:"325"}),r.createElement("use",{href:"#svgLeaf",x:"1050",y:"220",width:"160",height:"400"}),r.createElement("use",{href:"#svgLeaf",x:"1000",y:"48",width:"96",height:"240"}),r.createElement("use",{href:"#svgLeaf",x:"640",y:"560",width:"130",height:"325",opacity:"0.5"}),r.createElement("use",{href:"#svgTarget",x:"600",y:"0",width:"400",height:"500"})),r.createElement("use",{href:"#svgArcher",x:"0",y:"80",width:"600",height:"800"}))),r.createElement("div",{className:a},r.createElement(l.A,null)))}},4140:function(e,t,n){n.d(t,{A:function(){return y}});var r=n(6540),l=n(4398),a=n(8244),o=n(2424),i=n(117),s=n(6872),c=n(7179),u="heroBanner_planSelection-module--infoC--83693",m="heroBanner_planSelection-module--planSelectionHeroBanner--4ec7a",d="heroBanner_planSelection-module--svgC--937bc",h="heroBanner_planSelection-module--svgL--78de2",g="heroBanner_planSelection-module--svgR--aa723";function p(e){const{show:t}=(0,r.useContext)(s.ib),{setActiveForm:n}=(0,r.useContext)(c.FX);return r.createElement("div",Object.assign({className:m},e),r.createElement("div",{className:d},r.createElement("svg",{className:h,version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1120 880"},r.createElement("use",{href:"#svgGrass",x:"0",y:"0",width:"824",height:"824"}),r.createElement("use",{href:"#svgLeaf",x:"-120",y:"80",width:"232",height:"580"}),r.createElement("use",{href:"#svgLeaf",x:"136",y:"368",width:"144",height:"360",opacity:"0.5"})),r.createElement("svg",{className:g,version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1120 880"},r.createElement("use",{href:"#svgHeroMainBlob",x:"80",y:"-52",width:"1200",height:"960",opacity:"0.5"}),r.createElement("use",{href:"#svgHeroMainBlob",x:"200",y:"16",width:"1120",height:"800"}),r.createElement("clipPath",{id:"svgHeroMainBlobPathClip"},r.createElement("use",{href:"#svgHeroMainBlobPath",x:"200",y:"16"}),r.createElement("use",{href:"#svgHeroMainBlobPath",x:"80",y:"8"})),r.createElement("g",{clipPath:"url(#svgHeroMainBlobPathClip)"},r.createElement("use",{href:"#svgLeaf",x:"900",y:"440",width:"130",height:"325"}),r.createElement("use",{href:"#svgLeaf",x:"1050",y:"220",width:"160",height:"400"}),r.createElement("use",{href:"#svgLeaf",x:"1000",y:"48",width:"96",height:"240"}),r.createElement("use",{href:"#svgLeaf",x:"640",y:"560",width:"130",height:"325",opacity:"0.5"}),r.createElement("use",{href:"#svgTarget",x:"600",y:"0",width:"400",height:"500"})),r.createElement("use",{href:"#svgArcher",x:"0",y:"80",width:"600",height:"800"}))),r.createElement("div",{className:u},r.createElement(o.A,{onPlan1BtnClick:()=>{n("1monthPlanBuyConfirmation"),t()},onPlan2BtnClick:()=>{n("6monthsPlanBuyConfirmation"),t()},onPlan3BtnClick:()=>{n("12monthsPlanBuyConfirmation"),t()}})))}var f=n(7432);function E(e){let{children:t}=e;const{0:n,1:o}=(0,r.useState)(!1),{id:s,exp:c,isPlanActive:u,checkIfPlanActive:m}=(0,r.useContext)(i.R);return(0,r.useEffect)((()=>{m&&"function"==typeof m&&(async()=>{await m().finally((()=>{o(!0)}))})()}),[c,u]),r.createElement(r.Fragment,null,!u&&r.createElement(l.A,null),n?s?u?t:r.createElement(p,null):r.createElement(a.A,null):r.createElement(f.A,{coverFullPage:!0}))}function y(e){let{children:t}=e;return r.createElement(E,null,t)}}}]);