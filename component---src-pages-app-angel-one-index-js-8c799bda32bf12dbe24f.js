"use strict";(self.webpackChunkkaagzi=self.webpackChunkkaagzi||[]).push([[158],{4723:function(e,t,n){n.d(t,{A:function(){return T}});var r=n(6540),o=n(1298),a=n(1381),s=n(5832);const l=(0,r.createContext)({id:null,name:null,email:null,authToken:null,feedToken:null,chkIfAngelOneUserIsLoggedIn:()=>{},checkIfBrokerSessionIsAlive:()=>{},logOut:async()=>{}});function c(e){let{children:t}=e;const{0:n,1:c}=(0,r.useState)(null),{0:i,1:u}=(0,r.useState)(null),{0:d,1:m}=(0,r.useState)(null),{0:g,1:h}=(0,r.useState)(null),{0:y,1:p}=(0,r.useState)(null),{0:f,1:b}=(0,r.useState)(null),{notify:w}=(0,r.useContext)(o._),S=(0,r.useContext)(a.M),k=(0,r.useRef)(null),E=()=>{c(null),u(null),m(null),h(null),p(null),b(null),k.current=null},v=async()=>{const e=localStorage.getItem("angelOneUser");if(!e)return E(),!1;const t=JSON.parse(e);return!(Date.now()-t.t>864e5)&&(h(t.atk),p(t.ftk),c(t.id),u(t.nm),m(t.eml),b(t.mac),t)},A=e=>{if(e.source==window&&(e.origin.startsWith("http://localhost:")||"https://kaagzi.in"===e.origin)&&Object.prototype.hasOwnProperty.call(e.data,"msgFlowDirection")&&"contentScript-to-webPage"===e.data.msgFlowDirection&&Object.prototype.hasOwnProperty.call(e.data,"action")&&"angelOneUserUpdated"===e.data.action)(async()=>{await v()})()};return(0,r.useEffect)((()=>(window.addEventListener("message",A),()=>{window.removeEventListener("message",A)})),[]),(0,r.useEffect)((()=>{(async()=>{await v()})()}),[S]),r.createElement(r.Fragment,null,null!==n&&null!==g?r.createElement(l.Provider,{value:{id:n,name:i,email:d,authToken:g,feedToken:y,chkIfAngelOneUserIsLoggedIn:v,checkIfBrokerSessionIsAlive:()=>{const e=localStorage.getItem("angelOneUser");if(!e)return E(),!1;const t=JSON.parse(e);return!(Date.now()-t.t>864e5)||(E(),localStorage.removeItem("angelOneUser"),!1)},logOut:()=>{g&&fetch("https://apiconnect.angelbroking.com/rest/secure/angelbroking/user/v1/logout",{method:"POST",headers:{Authorization:"Bearer "+g,"Content-Type":"application/json",Accept:"application/json","X-UserType":"USER","X-SourceID":"WEB","X-MACAddress":f,"X-PrivateKey":"qYVfXeyL"},body:JSON.stringify({clientcode:n})}).then((e=>e.json())).then((e=>{let{message:t,errorcode:n}=e;"SUCCESS"===t&&""===n&&w("Successfully logged out of Angel One","success")})).catch((e=>{w("Logged out of Angel One")})),E(),localStorage.removeItem("angelOneUser")}}},t):r.createElement(s.A,{broker:"Angel One",doOnLoginClick:()=>{if(!S)return w("Network unavailable","err"),null;null!==k.current&&(k.current.close(),k.current=null);try{k.current=window.open("https://smartapi.angelbroking.com/publisher-login?api_key=qYVfXeyL","AngelOne Login","popup=yes,resizable=no,location=no,menubar=no,scrollbars=yes,status=no,titlebar=no,toolbar=no,fullscreen=no,dependent=no,height=480,width=480")}catch(e){console.log(e)}},referralUrlForNewSignupWithBroker:"https://www.angelone.in/register/?referrer=NX66694QFZ"}))}var i=n(7432),u=n(117);const d=(0,r.createContext)({isMasterDataReady:!1,masterDataEpochTimestamp:null,getInstrument:async(e,t)=>{},getInstruments:async e=>{},getTokenForInstruments:async e=>{},searchInstruments:async(e,t,n,r,o,a,s)=>{}});function m(e){let{children:t}=e;const{0:n,1:o}=(0,r.useState)(!1),{0:s,1:c}=(0,r.useState)(!1),{0:m,1:g}=(0,r.useState)(null),h=(0,r.useContext)(a.M),{id:y}=(0,r.useContext)(u.R),{id:p,authToken:f}=(0,r.useContext)(l),b=(0,r.useRef)(null),w=["NSE","BSE","NFO","CDS","MCX"];async function S(){return new Promise(((e,t)=>{var n;if("IDBDatabase"==(null===(n=b.current)||void 0===n?void 0:n.constructor.name)){var r,o,a;if("AngelOneMasterData"===(null===(r=b.current)||void 0===r?void 0:r.name))return e(b.current);null===(o=b.current)||void 0===o||null===(a=o.close)||void 0===a||a.call(o)}const s=indexedDB.open("AngelOneMasterData",1);s.onupgradeneeded=e=>{b.current=s.result,0===e.oldVersion?[].concat(w,["metaData"]).forEach((e=>{b.current.objectStoreNames.contains(e)||b.current.createObjectStore(e)})):e.oldVersion>0&&e.oldVersion<1&&[].concat(w,["metaData"]).forEach((e=>{b.current.createObjectStore(e)}))},s.onerror=()=>{t(s.error)},s.onsuccess=t=>{b.current=s.result,b.current.onversionchange=()=>{b.current.close(),b.current=null,console.warn("Master database is outdated, please reload the page")},b.current.onclose=()=>{b.current=null},e(b.current)}}))}const k=async(e,t)=>{if(!e)return null;if("string"==typeof e&&""===e.trim())return null;if(!["readonly","readwrite","versionchange"].includes(t))return null;try{const r=await S();if(!r)return null;const o=r.objectStoreNames;if(o.length<1)return null;const a=Array.from(o);if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(!a.includes(e[n]))throw new Error("The "+e[n]+" table does not exist in cache database")}else if("string"==typeof e&&!a.includes(e))throw new Error("The "+e+" table does not exist in cache database");return r.transaction(e,t)}catch(r){return console.error("MASTER-DATA: _withDbTransaction()",r.message||r||"Error initiating transaction"),null}},E=async()=>{const e=await S();return!!e&&new Promise(((t,n)=>{try{const r=e.objectStoreNames;if(r.length<1)return t(!0);const o=Array.from(r),a=e.transaction(o,"readwrite");a.onabort=()=>n(a.error),a.oncomplete=()=>t(!0),o.forEach((e=>{a.objectStore(e).clear()}))}catch(r){n()}}))},v=async()=>{try{if(await(async()=>{try{const e=await k("metaData","readonly"),t=await new Promise(((t,n)=>{const r=e.objectStore("metaData").get("masterData_dl_timestamp");r.onerror=()=>n(r.error),r.onsuccess=()=>t(void 0!==r.result?r.result:null)}));if(!t)return!1;const n=new Date,r=new Date;r.setHours(8,30,0,0);const o=new Date(r);o.setDate(o.getDate()-1);const a=new Date(t);return n>=r?a>=r?Number(t):(E(),!1):a>=o?Number(t):(E(),!1)}catch(e){return!1}})())console.log("MASTER DATA: Already loaded and valid"),c(!0);else{if(n)return!1;console.log("MASTER DATA: Loading"),await(async()=>{if(n)return!1;try{o(!0);const e=await Promise.all(w.map((async e=>{const t=await fetch(`https://nimworks.github.io/market-data/angelOne/${e}.csv.gz`,{method:"GET",headers:{"Accept-Encoding":"gzip"}});if(!t.ok)throw new Error(`Failed to fetch ${e} data (Status: ${t.status})`);const n=await t.blob(),r=new DecompressionStream("gzip"),o=n.stream().pipeThrough(r),a=await new Response(o).text();if(!a)throw new Error(`Error decompressing ${e}.csv.gz`);const s=a.trim().split("\n");return s.shift(),{xch:e,rows:s}})));if(!e||e.some((e=>!e.rows)))throw new Error("Error fetching Upstox master data");return await E(),c(!1),new Promise(((t,n)=>{(async()=>{const r=await k([].concat(w,["metaData"]),"readwrite");r.onabort=()=>n(r.error);const a=r.objectStore("NSE"),s=r.objectStore("BSE"),l=r.objectStore("NFO"),i=r.objectStore("CDS"),u=r.objectStore("MCX");e.forEach((e=>{let{xch:t,rows:n}=e;"NSE"===t?n.forEach((e=>{const[t,n]=e.split("/");a.put(n,t)})):"BSE"===t?n.forEach((e=>{const[t,n]=e.split("/");s.put(n,t)})):"NFO"===t?n.forEach((e=>{const[t,n]=e.split("/");l.put(n,t)})):"CDS"===t?n.forEach((e=>{const[t,n]=e.split("/");i.put(n,t)})):"MCX"===t&&n.forEach((e=>{const[t,n]=e.split("/");u.put(n,t)}))}));const d=r.objectStore("metaData"),m=Date.now();d.put(m,"masterData_dl_timestamp"),r.commit(),c(!0),g(m),o(!1),t(new Date(m))})()}))}catch(e){return console.error("MASTER-DATA: _fetchMasterDataAndUpdateInDb()",e.message||e||"Error fetching"),o(!1),!1}})()}return!0}catch(e){return!1}},A=(e,t,n)=>{try{if("NSE"===n||"BSE"===n){const[r,o]=t.split(",");if(void 0===o)return null;return""===o.trim()?{token:r,symbol:e,name:e,lotSize:0,exchange:n,isNotTradeable:!0}:{token:r,symbol:e,name:e,lotSize:Number(o),exchange:n}}{const[r,o]=t.split(",");if(void 0===o)return null;const[a,s,l,c]=e.split("|");return void 0===s?{token:r,symbol:e,name:e,lotSize:0,exchange:n,isNotTradeable:!0}:{token:r,symbol:e,name:a,expiry:new Date(l).getTime(),lotSize:Number(o),type:"C"===s?"CE":"P"===s?"PE":"F"===s?"FUT":void 0,strike:"F"===s?void 0:Number(c),exchange:n}}}catch(r){return console.error("MASTER-DATA: _parse_indexedDbKeyVal_to_instrument()",r.message||r||"Error"),null}},O=async(e,t)=>{if(!t||"string"!=typeof t)return null;if(""===t.trim())return null;try{if(!await v())return null;const n=await k(e,"readonly");if(!n)return null;const r=n.objectStore(e).get(t);return new Promise(((n,o)=>{r.onerror=()=>o(r.error),r.onsuccess=()=>{n(void 0!==r.result?A(t,r.result,e):null)}}))}catch(n){return null}},x=async e=>{if(!e)return null;if("object"!=typeof e)return null;const t=Object.keys(e);if(t.length<1)return null;try{return await v()?new Promise(((n,r)=>{(async()=>{const o=await k(t,"readonly");if(!o)return null;const a=[],s=[];o.onabort=()=>r(o.error),o.oncomplete=()=>n({instrumentsFound:a,instrumentsNotFound:s});await Promise.all(t.map((async t=>{if(!w.includes(t))return!1;const n=o.objectStore(t);await Promise.all(e[t].map((e=>new Promise(((r,l)=>{const c=n.get(e);c.onsuccess=()=>{if(void 0!==c.result){const n=A(e,c.result,t);n?a.push(n):console.warn("MASTER-DATA: getInstruments() Error parsing CSV for "+e)}else s.push({symbol:e,exchange:t});r(!0)},c.onerror=()=>{console.warn("MASTER-DATA: getInstruments() Error while reading data for "+e,o.error),s.push({symbol:e,exchange:t}),r(!0)}})))));return!0})));o.commit()})()})):null}catch(n){return null}};return(0,r.useEffect)((()=>{h&&(y||p)&&(async()=>{await v()})()}),[h,y,p]),r.createElement(d.Provider,{value:{isMasterDataReady:s,masterDataEpochTimestamp:m,getInstrument:O,getInstruments:x,getTokenForInstruments:async e=>{if(!e)return null;if("object"!=typeof e)return null;const t=Object.keys(e);if(t.length<1)return null;try{return await v()?new Promise(((n,r)=>{(async()=>{const o=await k(t,"readonly");if(!o)return null;const a={},s=[];o.onabort=()=>r(o.error),o.oncomplete=()=>n({instrumentsAndTheirToken:a,instrumentsNotFound:s});await Promise.all(t.map((async t=>{if(!w.includes(t))return!1;const n=o.objectStore(t);await Promise.all(e[t].map((e=>new Promise(((r,l)=>{const c=n.get(e);c.onsuccess=()=>{if(void 0!==c.result){const n=A(e,c.result,t);null!==n&&(a[`${n.symbol}:${t}`]=n.token)}else s.push({symbol:e,exchange:t});r(!0)},c.onerror=()=>{console.warn("MASTER-DATA: getTokenForInstruments() Error while reading data for "+e,o.error),s.push({symbol:e,exchange:t}),r(!0)}})))));return!0})));o.commit()})()})):null}catch(n){return null}},searchInstruments:async(e,t,n,r,o,a,s)=>{if(""===t.trim())return null;t=t.toUpperCase(),s&&void 0!==s&&Number.isInteger(Number(s))||(s=20);if(!await v())return null;const l=await k(e,"readonly");if(!l)return null;const c={CE:"C",PE:"P",FUT:"F"};return await new Promise(((i,u)=>{try{const u=l.objectStore(e).openCursor(IDBKeyRange.bound(t,t+"￿")),d=[];let m=0;u.onsuccess=l=>{const u=l.target.result;if(u&&m<s){if(u.key.startsWith(t))if("NFO"!==e&&"CDS"!==e&&"MCX"!==e||null==n&&null==r&&null==o&&null==a){const t=A(u.key,u.value,e);t&&(d.push(t),m++)}else{let t=!0;if(n&&!u.key.includes(`|${c[n]}|`)&&(t=!1),r&&!u.key.includes(`|${r.toString()}-`)&&(t=!1),o&&!u.key.includes(`-${o<10?"0":""}${o.toString()}-`)&&(t=!1),a&&"FUT"!==n&&!u.key.endsWith(`|${a.toString()}`)&&(t=!1),t){const t=A(u.key,u.value,e);t&&(d.push(t),m++)}}u.continue()}else i(d)},u.onerror=e=>{console.warn("MASTER-DATA: searchInstruments() Cursor Error",l.error),i(null)}}catch(d){console.warn("MASTER-DATA: searchInstruments()",d.message||d||"Error while searching"),i(null)}}))}}},"function"==typeof t?null==t?void 0:t(O,x):t,n&&r.createElement(i.A,{note:"Connecting to market",coverFullPage:!0}))}var g=n(6660);const h=(0,r.createContext)({quotes:{NSE:{},NFO:{},BSE:{},MCX:{},CDS:{}},socketStatus:0,tick:0,subscribeToQuotes:async e=>{},unsubscribeToQuotes:e=>{}});function y(e){let{children:t}=e;const{id:n,feedToken:o,checkIfBrokerSessionIsAlive:a}=(0,r.useContext)(l),s=(0,r.useRef)({NSE:{},NFO:{},BSE:{},MCX:{},CDS:{}}),{socketStatus:c,tick:i,sendData:u}=(0,g.A)(`wss://smartapisocket.angelone.in/smart-stream?clientCode=${encodeURIComponent(n)}&feedToken=${encodeURIComponent(o)}&apiKey=${{}.AngelOne_apiKey}`,(async e=>{try{const t=await e.arrayBuffer();if(!t)return!1;if(t.byteLength<=2)return!1;const n=new DataView(t),r=n.getUint8(1);let o=new Uint8Array(t,2,25),a=String.fromCharCode.apply(null,o).replace(/\0/g,""),l=Number(n.getBigUint64(43,!0));l=13===r?l/1e7:l/100;let c=Number(n.getBigUint64(115,!0));return c=13===r?c/1e7:c/100,1==r&&(s.current.NSE[a]={ltp:l,cp:c}),2==r&&(s.current.NFO[a]={ltp:l,cp:c}),3==r&&(s.current.BSE[a]={ltp:l,cp:c}),5==r&&(s.current.MCX[a]={ltp:l,cp:c}),13==r&&(s.current.CDS[a]={ltp:l,cp:c}),!0}catch(t){return!1}}),null),d=e=>{if(!e||!Array.isArray(e)||e.length<1)return null;try{const t=e.reduce(((e,t)=>{let{token:n,exchange:r}=t;return e[r]||(e[r]=[]),!e[r].includes(n)&&e[r].push(n),e}),{});return Object.keys(t).length?t:null}catch(t){return null}};return r.createElement(h.Provider,{value:{quotes:s.current,socketStatus:c,tick:i,subscribeToQuotes:async e=>{try{const t=d(e);if(!t)return!1;if(!await a())return!1;const n={correlationID:"abcde12345",action:1,params:{mode:2,tokenList:[]}};return Object.keys(t).forEach((e=>{var r=1;"NFO"===e&&(r=2),"BSE"===e&&(r=3),"MCX"===e&&(r=5),"CDS"===e&&(r=13),n.params.tokenList.push({exchangeType:r,tokens:t[e]})})),await u(JSON.stringify(n),!0,!0)}catch(t){return console.error(t),!1}},unsubscribeToQuotes:e=>{if(2!==c)return!1;try{const t=d(e);if(!t)return!1;const n={correlationID:"abcde12345",action:0,params:{mode:2,tokenList:[]}};return Object.keys(t).forEach((e=>{var r=1;"NFO"===e&&(r=2),"BSE"===e&&(r=3),"MCX"===e&&(r=5),"CDS"===e&&(r=13),n.params.tokenList.push({exchangeType:r,tokens:t[e]})})),u(JSON.stringify(n)),Object.keys(t).forEach((e=>{for(const n of t[e])Object.hasOwn(s.current,e)&&Object.hasOwn(s.current[e],n)&&delete s.current[e][n]})),!0}catch(t){return console.error(t),!1}}}},t)}var p=n(5946),f=n(8583),b=n(4506),w=n(7765),S=n(1291),k=n(4398),E=n(9322),v=n(8208),A=n(998),O=n(6278),x=n(6422),C=n(7486);function D(){const{notify:e}=(0,r.useContext)(o._),t=(0,r.useContext)(a.M),{id:n,checkIfPlanActive:s,checkIfLoginSessionIsValid:c}=(0,r.useContext)(u.R),{name:i,logOut:m}=(0,r.useContext)(l),{isMasterDataReady:g,searchInstruments:y}=(0,r.useContext)(d),{socketStatus:p,quotes:f,tick:D,subscribeToQuotes:T,unsubscribeToQuotes:N}=(0,r.useContext)(h),{0:I,1:P}=(0,r.useState)([]),{0:j,1:F}=(0,r.useState)([]),{0:M,1:B}=(0,r.useState)(0),{0:R,1:U}=(0,r.useState)(null),{0:L,1:$}=(0,r.useState)(null),{0:q,1:X}=(0,r.useState)(!1),_=(0,r.useCallback)((async e=>{try{if(!Array.isArray(e))throw new Error("Array of instruments expected");return!(e.length<1)&&await T(e.map((e=>{let{token:t,exchange:n}=e;return{token:t,exchange:n}})))}catch(t){return console.error("SCAFFOLD: subscribeToQuotes_mod():",t.message||t),!1}}),[]),z=(0,r.useCallback)((e=>{try{if(!Array.isArray(e))throw new Error("Array of watchlist instruments expected");return!(e.length<1)&&N(e.map((e=>{let{token:t,exchange:n}=e;return{token:t,exchange:n}})))}catch(t){return console.error("SCAFFOLD: unsubscribeToQuotes_mod():",t.message||t),!1}}),[]),V=(0,C.A)(I,j,R,_,z,p,g),Q=async(n,r)=>{if(!t)return e("Network Unavailable","alert"),!1;try{return n.isNotTradeable?(e(n.symbol+" is not tradeable","alert"),!1):(U(n),!0)}catch(o){return!1}},W=async(e,t,r)=>{try{if(!await c())return!1;await s();const o=await browser.runtime.sendMessage({action:"position_exit",userId:n,tradingsymbol:e.symbol,exchange:e.exchange,exitPrice:t,exitQty:e.qty,isSellTrade:r||!1,brokerCode:"ao"});if(!o||!Object.hasOwn(o,"status"))return!1;if("error"===o.status)throw new Error(o.error);return"success"===o.status&&(!!Object.hasOwn(o,"exitedPosition")&&(J(o.exitedPosition),!0))}catch(o){console.error(o)}},J=e=>{const t=I.find((t=>t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir));t&&(t.qty===e.qty?P(I.filter((t=>!(t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir)))):e.qty<t.qty&&P(I.map((t=>(t.symbol===e.sbl&&t.exchange===e.xh&&t.dir===e.dir&&(t.qty=t.qty-e.qty,t.h=Object.hasOwn(t,"h")&&t.h&&Array.isArray(t.h)?[[Date.now(),-1*e.qty,e.cp]].concat((0,b.A)(t.h)):[[Date.now(),-1*e.qty,e.cp]]),t)))))};return(0,r.useEffect)((()=>{if(Object.keys(f.NSE).length<1&&Object.keys(f.BSE).length<1&&Object.keys(f.NFO).length<1&&Object.keys(f.MCX).length<1&&Object.keys(f.CDS).length<1)return;let t=0;I.forEach((n=>{var r;if(!Object.hasOwn(f,n.exchange))return;if(!Object.hasOwn(f[n.exchange],n.token.toString()))return;const o=null===(r=f[n.exchange][n.token.toString()])||void 0===r?void 0:r.ltp;null!=o&&null!=o&&("B"===n.dir?(t+=(o-n.avg)*n.qty,null!==n.sl&&void 0!==n.sl&&o<=n.sl&&(W(n,n.sl,!1),e(`SL hit for ${n.exchange}:${n.symbol} buy trade`,"alert")),null!==n.tp&&void 0!==n.tp&&o>=n.tp&&(W(n,n.tp,!1),e(`TP hit for ${n.exchange}:${n.symbol} buy trade`,"success"))):(t+=(n.avg-o)*n.qty,null!==n.sl&&void 0!==n.sl&&o>=n.sl&&(W(n,n.sl,!0),e(`SL hit for ${n.exchange}:${n.symbol} sell trade`,"alert")),null!==n.tp&&void 0!==n.tp&&o<=n.tp&&(W(n,n.tp,!0),e(`TP hit for ${n.exchange}:${n.symbol} sell trade`,"success"))))})),B(t)}),[D,I]),r.createElement(r.Fragment,null,r.createElement(k.j,{broker:"Angel One",brokerLoggedInUserName:i,brokerLogOut:m,doOnWatchListBtnClick:X.bind(this,!0)}),r.createElement(w.A,{currentBroker:"Angel One",currentBrokerCode:"ao",isMasterDataReady:g,socketStatus:p,isSocketRetryWip:V,positionsAry:I,setPositionsAry:P,invokeInstrumentForTransaction:Q,instrumentInvokedForTransaction:R,renderNewPosDialog:(e,t)=>r.createElement(A.A,{doNotCloseIfClickedOnBackdrop:!0,doOnClose:U.bind(this,null)},(n=>{var o,a,s,l;const{token:c,symbol:i,exchange:u,lotSize:d}=R;return r.createElement(O.A,{instrument:R,ltp:null==f||null===(o=f[u])||void 0===o||null===(a=o[c])||void 0===a?void 0:a.ltp,closePrice:null==f||null===(s=f[u])||void 0===s||null===(l=s[c])||void 0===l?void 0:l.cp,enterPosition:e,doOnOpeningOrUpdatingPos:()=>{t(),X(!1)},closeDialog:n})})),posInvokedForViewingDetailsOrExiting:L,renderPosMgmtDialog:(e,t)=>r.createElement(A.A,{doOnClose:$.bind(this,null)},(n=>{var o,a;return r.createElement(x.A,{positionToExit:L,ltp:null==f||null===(o=f[L.exchange])||void 0===o||null===(a=o[L.token])||void 0===a?void 0:a.ltp,exitPosition:e,addLotsToPosition:t,closeDialog:n})})),totalPnL:M,calcPnlPerExchangeType:()=>{if(Object.keys(f).length<1)return null;let e=0,t=0,n=0,r=0;return I.forEach((o=>{var a,s;if(!Object.hasOwn(f,o.exchange))return;if(!Object.hasOwn(f[o.exchange],o.token.toString()))return;const l="B"===o.dir?((null===(a=f[o.exchange][o.token.toString()])||void 0===a?void 0:a.ltp)-o.avg)*o.qty:(o.avg-(null===(s=f[o.exchange][o.token.toString()])||void 0===s?void 0:s.ltp))*o.qty;"NSE"===o.exchange||"BSE"===o.exchange?e+=l:"NFO"===o.exchange?t+=l:"MCX"===o.exchange?n+=l:"CDS"===o.exchange&&(r+=l)})),{eq:e,fno:t,com:n,cds:r,total:e+t+n+r}},searchFilterExchangesAry:["NSE","BSE","NFO","CDS","MCX"],searchInstruments:y},I.map(((e,t)=>{var n,o;const{symbol:a,exchange:l,avg:i,qty:u,dir:d,expiry:m,token:g}=e;return r.createElement(E.A,{wrapperElement:"div",key:`${t}:${g}`,tradingsymbol:a,exchange:l,qty:u,avg:i,ltp:null==f||null===(n=f[l])||void 0===n||null===(o=n[g])||void 0===o?void 0:o.ltp,direction:d,onClick:async t=>{await c()&&(await s(),$(e),t.stopPropagation())}})}))),q&&r.createElement(A.A,{doOnClose:()=>{F([]),X(!1)}},r.createElement(S.A,{currentBroker:"Angel One",currentBrokerCode:"ao",isMasterDataReady:g,socketStatus:p,isSocketRetryWip:V,watchlistInstrumentsAry:j,setWatchlistInstrumentsAry:F,searchFilterExchangesAry:["NSE","BSE","NFO","CDS","MCX"],searchInstruments:y},((n,o,a)=>j.map(((s,l)=>{var c,i,u,d;const{symbol:m,name:g,token:h,exchange:y,expiry:p,isNotTradeable:b}=s,w=o&&o.token===h;return r.createElement(v.A,{wrapperElement:"div",key:h,onClick:a.bind(this,w?{}:s),isExpandedView:w,tradingsymbol:m,entityName:g,exchange:y,ltp:null==f||null===(c=f[y])||void 0===c||null===(i=c[h])||void 0===i?void 0:i.ltp,closePrice:null==f||null===(u=f[y])||void 0===u||null===(d=u[h])||void 0===d?void 0:d.cp,expiry:p,closeExpandedView:a.bind(this,{}),isNotTradeable:b,onBuyClick:()=>{var n,r;t?null!=f&&null!==(n=f[y])&&void 0!==n&&null!==(r=n[h])&&void 0!==r&&r.ltp?(async()=>{await Q(s)})():e("Error inferring price for "+m,"err"):e("Network unavailable","err")},onRemoveClick:()=>{n(m,y,h).then((()=>{a({})}))}})}))))))}function T(){return r.createElement(c,null,r.createElement(m,null,((e,t)=>r.createElement(p.A,null,r.createElement(f.A,{currentBrokerCode:"ao",masterData_getInstrument:e,masterData_getInstruments:t},r.createElement(y,null,r.createElement(D,null)))))))}},5439:function(e,t,n){n.r(t),n.d(t,{Head:function(){return c},default:function(){return l}});var r=n(6540),o=n(4140),a=n(268),s=n(8719);function l(){return r.createElement(o.A,null,r.createElement(a.A,null,(()=>{const e=n(4723).A;return r.createElement(e,null)})))}function c(){return r.createElement(s.y,{title:"Angel One"})}}}]);